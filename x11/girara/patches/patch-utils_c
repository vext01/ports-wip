$OpenBSD$
--- utils.c.orig	Sat Mar 24 20:16:33 2012
+++ utils.c	Thu May 10 18:09:07 2012
@@ -258,22 +258,30 @@ girara_file_read_line(FILE* file)
 char*
 girara_file_read_line(FILE* file)
 {
+  char *copy;
+
   if (file == NULL) {
     return NULL;
   }
 
   size_t size = 0;
   char* line = NULL;
-  if (getline(&line, &size, file) == -1) {
-    if (line != NULL) {
-      free(line);
-    }
+
+  if ((line = fgetln(file, &size)) == NULL) {
+    if (ferror(file))
+	    perror("fgetln");
     return NULL;
   }
 
   /* remove the trailing line deliminator */
   g_strdelimit(line, "\n\r", '\0');
-  return line;
+
+  if ((copy = strdup(line)) == NULL) {
+	  perror("strdup");
+	  return NULL;
+  }
+
+  return copy;
 }
 #endif
 
